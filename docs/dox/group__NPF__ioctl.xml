<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="group__NPF__ioctl">
    <title>NPF I/O control codes</title>
        <section>
            <title>Detailed Description</title>
        </section>
        <section>
            <title>Macros</title>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1ga71817d3a52bf0ec819934a5f688a172c">BIOCSETBUFFERSIZE</link> 9592<para><emphasis>IOCTL code: set kernel buffer size.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1gaf85f500f68404076ac60ffe6e08818da">BIOCSETF</link> 9030<para><emphasis>IOCTL code: set packet filtering program.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1ga8ae8be8faa281644d8be1cda38b826bd">BIOCGSTATS</link> 9031<para><emphasis>IOCTL code: get the capture stats.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1ga327015c2b2e347212b571d1fa3aa2f54">BIOCSRTIMEOUT</link> 7416<para><emphasis>IOCTL code: set the read timeout.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1gad1012b82859d09864d246b1fa99d48d6">BIOCSMODE</link> 7412<para><emphasis>IOCTL code: set working mode.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1ga1436997ce2947bbbe22b5400254438a1">BIOCSWRITEREP</link> 7413<para><emphasis>IOCTL code: set number of physical repetions of every packet written by the app.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1gaa827e3441e3f84abc7df5e30fcee96d1">BIOCSMINTOCOPY</link> 7414<para><emphasis>IOCTL code: set minimum amount of data in the kernel buffer that unlocks a read call.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1gabf9a4779fd5281607510edc8b5d766dd">BIOCSETOID</link> 0x80000000<para><emphasis>IOCTL code: set an OID value.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1ga5a0ab3231052ff323817e288dab2f127">BIOCQUERYOID</link> 0x80000004<para><emphasis>IOCTL code: get an OID value.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1gac8b51f8abae12f57a2ea8e8e4c0cd53c">BIOCSETDUMPFILENAME</link> 9029<para><emphasis>IOCTL code: set the name of a the file used by kernel dump mode.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1gadd9e03a96d297a33d7cee4d750c34eff">BIOCGEVNAME</link> 7415<para><emphasis>IOCTL code: get the name of the event that the driver signals when some data is present in the buffer.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1gac50830dc08762383dcb203a66e5c853d">BIOCSENDPACKETSNOSYNC</link> 9032<para><emphasis>IOCTL code: Send a buffer containing multiple packets to the network, ignoring the timestamps.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1gab4d41e91e460bb101ef8ddb622a8e010">BIOCSENDPACKETSSYNC</link> 9033<para><emphasis>IOCTL code: Send a buffer containing multiple packets to the network, considering the timestamps.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1ga3205efe3271948f253c4da5abf0e12c6">BIOCSETDUMPLIMITS</link> 9034<para><emphasis>IOCTL code: Set the dump file limits.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1ga874d333aca88363bc6fdcb3e8b1af05b">BIOCISDUMPENDED</link> 7411<para><emphasis>IOCTL code: Get the status of the kernel dump process.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1gae02ae71d6fe0bfb4b600f8027dc90ba3">BIOCISETLOBBEH</link> 7410<para><emphasis>IOCTL code: set the loopback behavior.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                            <para>#define <link linkend="group__NPF__ioctl_1ga31c73f09a27bb38a6040a5841096576a">BIOCSETEVENTHANDLE</link> 7920<para><emphasis>This IOCTL passes the read event HANDLE allocated by the user (packet.dll) to kernel level.</emphasis></para>
</para>
                    </listitem>
                </itemizedlist>
            </para>
        </section>
        <section>
            <title>Macro Definition Documentation</title>
            <section xml:id="group__NPF__ioctl_1ga71817d3a52bf0ec819934a5f688a172c">
                <title>#define BIOCSETBUFFERSIZE</title>                
<para>This IOCTL is used to set a new size of the circular buffer associated with an instance of NPF. When a BIOCSETBUFFERSIZE command is received, the driver frees the old buffer, allocates the new one and resets all the parameters associated with the buffer in the OPEN_INSTANCE structure. The currently buffered packets are lost. </para>

                <para>Definition at line 103 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1gaf85f500f68404076ac60ffe6e08818da">
                <title>#define BIOCSETF</title>                
<para>This IOCTL sets a new packet filter in the driver. Before allocating any memory for the new filter, the bpf_validate() function is called to check the correctness of the filter. If this function returns TRUE, the filter is copied to the driver&apos;s memory, its address is stored in the bpfprogram field of the OPEN_INSTANCE structure associated with current instance of the driver, and the filter will be applied to every incoming packet. This command also empties the circular buffer used by current instance to store packets. This is done to avoid the presence in the buffer of packets that do not match the filter. </para>

                <para>Definition at line 115 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1ga8ae8be8faa281644d8be1cda38b826bd">
                <title>#define BIOCGSTATS</title>                
<para>This command returns to the application the number of packets received and the number of packets dropped by an instance of the driver. </para>

                <para>Definition at line 123 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1ga327015c2b2e347212b571d1fa3aa2f54">
                <title>#define BIOCSRTIMEOUT</title>                
<para>This command sets the maximum timeout after which a read is released, also if no data packets were received. </para>

                <para>Definition at line 130 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1gad1012b82859d09864d246b1fa99d48d6">
                <title>#define BIOCSMODE</title>                
<para>This IOCTL can be used to set the working mode of a NPF instance. The new mode, received by the driver in the buffer associated with the IOCTL command, can be <link linkend="group__NPF__include_1gac93c0a6ad1d2a3143b1115bdab3ac04d">MODE_CAPT</link> for capture mode (the default), <link linkend="group__NPF__include_1ga503326906a62e96c147ae6af31fb5659">MODE_STAT</link> for statistical mode or <link linkend="group__NPF__include_1ga89853f93dc8cc890b0665629d16d2831">MODE_DUMP</link> for dump mode. </para>

                <para>Definition at line 139 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1ga1436997ce2947bbbe22b5400254438a1">
                <title>#define BIOCSWRITEREP</title>                
<para>Sets the number of times a single write call must be repeated. This command sets the <link linkend="group__NPF_1gaf6b5b0a348f7a40d795b554b0eceed73">OPEN_INSTANCE::Nwrites</link> member, and is used to implement the &apos;multiple write&apos; feature of the driver. </para>

                <para>Definition at line 147 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1gaa827e3441e3f84abc7df5e30fcee96d1">
                <title>#define BIOCSMINTOCOPY</title>                
<para>This command sets the <link linkend="group__NPF_1ga263f7d6f5db5625541d275380685f0b1">OPEN_INSTANCE::MinToCopy</link> member. </para>

                <para>Definition at line 154 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1gabf9a4779fd5281607510edc8b5d766dd">
                <title>#define BIOCSETOID</title>                
<para>This IOCTL is used to perform an OID set operation on the NIC driver. </para>

                <para>Definition at line 161 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1ga5a0ab3231052ff323817e288dab2f127">
                <title>#define BIOCQUERYOID</title>                
<para>This IOCTL is used to perform an OID get operation on the NIC driver. </para>

                <para>Definition at line 168 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1gac8b51f8abae12f57a2ea8e8e4c0cd53c">
                <title>#define BIOCSETDUMPFILENAME</title>                
<para>This command opens a file whose name is contained in the IOCTL buffer and associates it with current NPf instance. The dump thread uses it to copy the content of the circular buffer to file. If a file was already opened, the driver closes it before opening the new one. </para>

                <para>Definition at line 177 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1gadd9e03a96d297a33d7cee4d750c34eff">
                <title>#define BIOCGEVNAME</title>                
<para>Command used by the application to retrieve the name of the global event associated with a NPF instance. The event is signaled by the driver when the kernel buffer contains enough data for a transfer. </para>

                <para>Definition at line 185 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1gac50830dc08762383dcb203a66e5c853d">
                <title>#define BIOCSENDPACKETSNOSYNC</title>                
<para>Command used to send a buffer of packets in a single system call. Every packet in the buffer is preceded by a <link linkend="structsf__pkthdr">sf_pkthdr</link> structure. The timestamps of the packets are ignored, i.e. the packets are sent as fast as possible. The <link linkend="group__NPF__code_1ga9a97dd25ae757da4bfed3723a4eb4bce">NPF_BufferedWrite()</link> function is invoked to send the packets. </para>

                <para>Definition at line 194 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1gab4d41e91e460bb101ef8ddb622a8e010">
                <title>#define BIOCSENDPACKETSSYNC</title>                
<para>Command used to send a buffer of packets in a single system call. Every packet in the buffer is preceded by a <link linkend="structsf__pkthdr">sf_pkthdr</link> structure. The timestamps of the packets are used to synchronize the write, i.e. the packets are sent to the network respecting the intervals specified in the <link linkend="structsf__pkthdr">sf_pkthdr</link> structure assiciated with each packet. <link linkend="group__NPF__code_1ga9a97dd25ae757da4bfed3723a4eb4bce">NPF_BufferedWrite()</link> function is invoked to send the packets. </para>

                <para>Definition at line 204 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1ga3205efe3271948f253c4da5abf0e12c6">
                <title>#define BIOCSETDUMPLIMITS</title>                
<para>This IOCTL sets the limits (maximum size and maximum number of packets) of the dump file created when the driver works in dump mode. </para>

                <para>Definition at line 212 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1ga874d333aca88363bc6fdcb3e8b1af05b">
                <title>#define BIOCISDUMPENDED</title>                
<para>This command returns TRUE if the kernel dump is ended, i.e if one of the limits set with BIOCSETDUMPLIMITS (amount of bytes or number of packets) has been reached. </para>

                <para>Definition at line 220 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1gae02ae71d6fe0bfb4b600f8027dc90ba3">
                <title>#define BIOCISETLOBBEH</title>                
<para>This IOCTL sets the loopback behavior of the driver with packets sent by itself: capture or drop. </para>

                <para>Definition at line 227 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
            <section xml:id="group__NPF__ioctl_1ga31c73f09a27bb38a6040a5841096576a">
                <title>#define BIOCSETEVENTHANDLE</title>                
<para>Parameter: HANDLE Parameter size: sizeof(HANDLE). If the caller is 32 bit, the parameter size is 4 bytes, even if sizeof(HANDLE) at kernel level is 8 bytes. That&apos;s why in this IOCTL code handler we detect a 32bit calling process and do the necessary thunking.</para>

<para>TODO GV:I will go to hell for this ugly IOCTL definition. We should use CTL_CODE!! </para>

                <para>Definition at line 238 of file ioctls.h</para>
                <para>The Documentation for this define was generated from the following file: </para>
                <para><itemizedlist><listitem><para>ioctls.h</para></listitem></itemizedlist></para>
            </section>
        </section>
</section>
